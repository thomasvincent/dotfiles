# .zshrc
# Managed by chezmoi - DO NOT EDIT DIRECTLY

# Enable Powerlevel10k instant prompt
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Set default editor
export EDITOR='{{ if and (hasKey . "preferences") (hasKey .preferences "editor") }}{{ .preferences.editor }}{{ else }}vim{{ end }}'

# Load plugins and modules
source "$HOME/.zsh/aliases.zsh"
source "$HOME/.zsh/functions.zsh"
source "$HOME/.zsh/completion.zsh"
source "$HOME/.zsh/history.zsh"
source "$HOME/.zsh/keybindings.zsh"

# Load conditionally enabled modules
{{- if .enable_cloud }}
source "$HOME/.zsh/cloud.zsh"
{{- end }}

{{- if or (and (hasKey . "security") (hasKey .security "gpg_signing") .security.gpg_signing) (and (hasKey . "security") (hasKey .security "use_ssh_agent") .security.use_ssh_agent) (and (hasKey . "security") (hasKey .security "use_keychain") .security.use_keychain) (and (hasKey . "security") (hasKey .security "use_1password") .security.use_1password) (and (hasKey . "security") (hasKey .security "use_yubikey") .security.use_yubikey) }}
source "$HOME/.zsh/security.zsh"
{{- end }}

# Workflow modules
{{- if .enable_workflows }}
source "$HOME/.zsh/workflows.zsh"
{{- end }}

{{- if .enable_productivity }}
source "$HOME/.zsh/productivity.zsh"
{{- end }}

# CI/CD workflows
{{- if or .enable_workflows .enable_dev_tools }}
source "$HOME/.zsh/cicd.zsh"
{{- end }}

# Development workflows
{{- if .enable_dev_tools }}
source "$HOME/.zsh/dev_workflows.zsh"
{{- end }}

# App integrations
{{- if .enable_productivity }}
source "$HOME/.zsh/app_workflows.zsh"
{{- end }}

# Ansible workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_ansible") .preferences.enable_ansible) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/ansible_workflows.zsh"
{{- end }}

# Java/Gradle workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_java") .preferences.enable_java) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/java_gradle_workflows.zsh"
{{- end }}

# Groovy workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_groovy") .preferences.enable_groovy) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/groovy_workflows.zsh"
{{- end }}

# AI/LLM workflows
{{- if and (hasKey . "preferences") (hasKey .preferences "enable_ai") .preferences.enable_ai }}
[[ -f "$HOME/.zsh/ai_workflows.zsh" ]] && source "$HOME/.zsh/ai_workflows.zsh"
{{- end }}

# Rails workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_rails") .preferences.enable_rails) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/rails_workflows.zsh"
{{- end }}

# OmniFocus workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_omnifocus") .preferences.enable_omnifocus) (and (hasKey . "enable_productivity") .enable_productivity) }}
source "$HOME/.zsh/omnifocus_workflows.zsh"
{{- end }}

# Rust workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_rust") .preferences.enable_rust) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/rust_workflows.zsh"
{{- end }}

# Ruby workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_ruby") .preferences.enable_ruby) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/ruby_workflows.zsh"
{{- end }}

# HashiCorp workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_hashicorp") .preferences.enable_hashicorp) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/hashicorp_workflows.zsh"
{{- end }}

# VS Code workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_vscode") .preferences.enable_vscode) (and (hasKey . "enable_editors") .enable_editors) }}
source "$HOME/.zsh/vscode_workflows.zsh"
{{- end }}

# GitHub workflows
{{- if or (and (hasKey . "preferences") (hasKey .preferences "enable_github") .preferences.enable_github) (and (hasKey . "enable_dev_tools") .enable_dev_tools) }}
source "$HOME/.zsh/github_workflows.zsh"
{{- end }}

# GTD workflows with different platforms
{{- if or .enable_macos_gtd .enable_gtd }}
source "$HOME/.zsh/macos_gtd_workflows.zsh"
{{- end }}

{{- if or .enable_google_gtd .enable_gtd }}
source "$HOME/.zsh/google_gtd_workflows.zsh"
{{- end }}

{{- if or .enable_microsoft_gtd .enable_gtd }}
source "$HOME/.zsh/microsoft_gtd_workflows.zsh"
{{- end }}

# FZF integration
source "$HOME/.zsh/fzf.zsh"

# Modern tool replacements
source "$HOME/.zsh/modern_tools.zsh"

# Utility functions
source "$HOME/.zsh/utils.zsh"

# Local customizations
[[ -f "$HOME/.zshrc.local" ]] && source "$HOME/.zshrc.local"

# Load powerlevel10k configuration
[[ -f "$HOME/.p10k.zsh" ]] && source "$HOME/.p10k.zsh"
