# =============================================================================
# Pre-commit Configuration
# =============================================================================
#
# Pre-commit hooks run automatically before each commit to catch issues early.
# This helps maintain code quality and prevents committing sensitive data.
#
# Setup:
#   brew install pre-commit
#   pre-commit install
#
# Manual run:
#   pre-commit run --all-files
#
# =============================================================================

repos:
  # ---------------------------------------------------------------------------
  # General file fixes
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Fix trailing whitespace
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]

      # Ensure files end with newline
      - id: end-of-file-fixer

      # Check for merge conflicts
      - id: check-merge-conflict

      # Validate YAML syntax
      - id: check-yaml
        args: [--allow-multiple-documents]

      # Validate JSON syntax
      - id: check-json

      # Check for large files
      - id: check-added-large-files
        args: ['--maxkb=1000']

      # Detect private keys
      - id: detect-private-key

      # Check executables have shebangs
      - id: check-executables-have-shebangs

      # Check for broken symlinks
      - id: check-symlinks

      # Mixed line endings
      - id: mixed-line-ending
        args: [--fix=lf]

  # ---------------------------------------------------------------------------
  # Shell script linting
  # ---------------------------------------------------------------------------
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.9.0.6
    hooks:
      - id: shellcheck
        args: [--severity=error]
        types: [shell]
        exclude: '(\.tmpl$|\.zsh$)'

  # ---------------------------------------------------------------------------
  # Secret detection
  # ---------------------------------------------------------------------------
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        exclude: '(package.lock.json|\.pem$|\.key$|\.tmpl$|chezmoi\.toml$)'

  # ---------------------------------------------------------------------------
  # Markdown linting
  # ---------------------------------------------------------------------------
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.38.0
    hooks:
      - id: markdownlint
        args: [--fix, --disable, MD013, MD033, MD041]

  # ---------------------------------------------------------------------------
  # YAML linting
  # ---------------------------------------------------------------------------
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.33.0
    hooks:
      - id: yamllint
        args: [-c, .yamllint.yml]

# =============================================================================
# Configuration
# =============================================================================

# Files to exclude from all hooks
exclude: '^(\.git/|.*\.min\.js$|.*\.min\.css$)'

# CI configuration
ci:
  autofix_prs: true
  autoupdate_schedule: weekly
